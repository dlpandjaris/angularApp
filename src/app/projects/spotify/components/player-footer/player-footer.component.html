<script src="https://sdk.scdn.co/spotify-player.js"></script>

<footer class="sticky-bottom">
  <div class="__container">
    <div class="left-controls">
      <div class="song" *ngIf="this.playbackState != null">
        <div class="song-picture">
          <img src="{{this.playbackState.item.album.images[2].url}}"/>
        </div>
        <div class="song-info">
          <div class="song-name">
            <p>{{this.playbackState.item.name}}</p>
          </div>
          <div class="artist-name">
            <p>{{get_artist_list()}}</p>
          </div>
        </div>
        <button class="player-button" (click)="toggle_favorite()" *ngIf="this.playbackState.currently_playing_type == 'track'">
          <svg class="playback-svg" [style.fill]="favoriteIconColor">
            <path [attr.d]="favoriteIcon"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="center-piece">
      <div class="player-controls">
        <button class="player-button" (click)="toggle_shuffle()">
          <svg class="playback-svg" [style.fill]="shuffleIconColor">
            <path [attr.d]="iconProvider.shuffleStart"></path>
            <path [attr.d]="iconProvider.shuffleEnd"></path>
          </svg>
        </button>
        <button class="player-button" (click)="skip_to_previous()">
          <svg class="playback-svg">
            <path [attr.d]="iconProvider.previous"></path>
          </svg>
        </button>
        <button class="play-button player-button" style="background-color: white; margin: 0 12px;" (click)="toggle_play()">
          <svg class="playback-svg" style="fill: black; width: 16px;">
            <path [attr.d]="playIcon"></path>
          </svg>
        </button>
        <button class="player-button" (click)="skip_to_next()">
          <svg class="playback-svg">
            <path [attr.d]="iconProvider.next"></path>
          </svg>
        </button>
        <button class="player-button" (click)="toggle_repeat()">
          <svg class="playback-svg" [style.fill]="repeatIconColor">
            <path [attr.d]="iconProvider.repeat"></path>
          </svg>
        </button>
      </div>
      <div class="playback-bar" *ngIf="this.playbackState">
        <div class="playback-time" style="text-align: right;">{{ms_to_min_sec(playbackState.progress_ms)}}</div>
          <div class="playback-slider" id="playback-slider" (click)="playback_clicked($event)">
            <div class="playback-progress" id="playback-progress">
              <div class="bar" [style.width.px]="playbackTimerWidthPx"></div>
              <div 
                cdkDrag 
                cdkDragBoundary=".playback-progress">
              </div>
              <div id="playback-progress-handle"></div>
            </div>
          </div>
        <div class="playback-time" style="text-align: left;">{{ms_to_min_sec(this.playbackState.item.duration_ms)}}</div>
      </div>
      <div class="playback-bar" *ngIf="!this.playbackState">
        <div class="playback-time" style="text-align: right;">-:--</div>
          <div class="playback-slider" id="playback-slider">
            <div class="playback-progress" id="playback-progress">
              <div class="bar" [style.width.px]="0"></div>
              <div 
                cdkDrag 
                cdkDragBoundary=".playback-progress">
              </div>
              <div id="playback-progress-handle"></div>
            </div>
          </div>
        <div class="playback-time" style="text-align: left;">-:--</div>
      </div>
    </div>
    
    <div class="right-controls">

      <div class="sound-bar" *ngIf="activeDevice">
        <ng-template #devicePickerContent>
          <div class="device-picker">
            <div class="device-picker-header">
              <div *ngIf="playbackState.is_playing; else currentDeviceIconBlock">
                <img class="play-animation" src="https://open.spotifycdn.com/cdn/images/device-picker-equaliser-animation.946e7243.webp">
              </div>
              <ng-template #currentDeviceIconBlock>
                <div *ngFor="let d of get_device_icons(this.activeDevice.type)">
                  <svg class="device-picker-svg" style="fill: rgb(29, 185, 84)">
                    <path [attr.d]="d"></path>
                  </svg>
                </div>
              </ng-template>
              <div id="current-device">
                <div class="current-device-text">
                  <h3>Current device</h3>
                </div>
                <div class="current-device-display">
                  <svg class="playback-svg" *ngIf="true" style="margin-inline-start: 6px; fill: rgb(29, 185, 84)">
                    <path [attr.d]="iconProvider.deviceNameDecoratorStart"></path>
                    <path [attr.d]="iconProvider.deviceNameDecoratorEnd"></path>
                  </svg>
                  <div class="current-device-text">
                    <p>{{activeDevice.name}}</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="device-picker-body">
              <div class="current-device-text">
                <h4>Select another device</h4>
              </div>
              <ul class="device-list">
                <li *ngFor="let device of devices">
                  <div *ngIf="device.id != activeDevice.id">
                    <button (click)="set_playback_device(device)">
                      <div *ngFor="let d of get_device_icons(device.type)">
                        <svg class="device-picker-svg">
                          <path [attr.d]="d"></path>
                        </svg>
                      </div>
                      <div class="device-text">
                        <p>{{device.name}}</p>
                      </div>
                    </button>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </ng-template>

        <button class="player-button" [ngbPopover]="devicePickerContent" (click)="get_available_devices()">
          <svg class="playback-svg">
            <path [attr.d]="iconProvider.defaultSpeakerOutside"></path>
            <path [attr.d]="iconProvider.defaultSpeakerInside"></path>
          </svg>
        </button>

        <button class="player-button" (click)="toggle_mute()">
          <svg class="playback-svg" *ngIf="activeDevice.volume_percent <= 0">
            <path [attr.d]="iconProvider.volumeMuteStart"></path>
            <path [attr.d]="iconProvider.volumeMuteEnd"></path>
          </svg>
          <svg class="playback-svg" *ngIf="activeDevice.volume_percent > 0 && activeDevice.volume_percent < 33">
            <path [attr.d]="iconProvider.volumeLow"></path>
          </svg>
          <svg class="playback-svg" *ngIf="activeDevice.volume_percent > 33 && activeDevice.volume_percent < 66">
            <path [attr.d]="iconProvider.volumeMedium"></path>
          </svg>
          <svg class="playback-svg" *ngIf="activeDevice.volume_percent > 66">
            <path [attr.d]="iconProvider.volumeLow"></path>
            <path [attr.d]="iconProvider.volumeHigh"></path>
          </svg>
        </button>
        <div class="sound-slider" id="sound-slider" (click)="volume_clicked($event)">
          <div class="audio-progress" id="audio-progress">
            <div class="bar" [style.width.%]="activeDevice.volume_percent"></div>
            <div 
              cdkDrag 
              cdkDragBoundary=".audio-progress">
              <!-- (cdkDragMoved)="volume_drag_move($event)"
              (cdkDragEnded)="volume_drag_end($event)" -->
            </div>
            <div id="audio-progress-handle"></div>
          </div>
        </div>
        <button class="player-button" [ngbPopover]="devicePickerContent"></button>
      </div>
    </div>
  </div>
</footer>